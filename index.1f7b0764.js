const e=new class{constructor(e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.board=e,this.score=0,this.status="idle"}start(){if("idle"===this.status){this.status="playing",this.addRandomTile(),this.addRandomTile(),this.render();let e=document.querySelector(".button");e&&(e.textContent="Restart")}}restart(){this.hideMessage(),this.board=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.score=0,this.status="idle";let e=document.querySelector(".game-score");e&&(e.textContent=this.score),this.render()}moveLeft(){if("playing"!==this.status)return;let e=0,t=!1;for(let s=0;s<4;s++){let{newRow:r,points:i,changed:o}=this.slideAndMerge(this.board[s]);o&&(this.board[s]=r,e+=i,t=!0)}t&&(this.addRandomTile(),this.render(),this.updateScore(e),this.checkGameOver())}moveRight(){if("playing"!==this.status)return;let e=0,t=!1;for(let s=0;s<4;s++){let r=[...this.board[s]].reverse(),{newRow:i,points:o,changed:a}=this.slideAndMerge(r);a&&(this.board[s]=i.reverse(),e+=o,t=!0)}t&&(this.addRandomTile(),this.render(),this.updateScore(e),this.checkGameOver())}moveUp(){if("playing"!==this.status)return;let e=0,t=!1;for(let s=0;s<4;s++){let r=[];for(let e=0;e<4;e++)r.push(this.board[e][s]);let{newRow:i,points:o,changed:a}=this.slideAndMerge(r);if(a){e+=o,t=!0;for(let e=0;e<4;e++)this.board[e][s]=i[e]}}t&&(this.addRandomTile(),this.render(),this.updateScore(e),this.checkGameOver())}moveDown(){if("playing"!==this.status)return;let e=0,t=!1;for(let s=0;s<4;s++){let r=[];for(let e=3;e>=0;e--)r.push(this.board[e][s]);let{newRow:i,points:o,changed:a}=this.slideAndMerge(r);if(a){e+=o,t=!0;for(let e=0;e<4;e++)this.board[3-e][s]=i[e]}}t&&(this.addRandomTile(),this.render(),this.updateScore(e),this.checkGameOver())}updateScore(e){this.score+=e;let t=document.querySelector(".game-score");t&&(t.textContent=this.score)}transposeBoard(){let e=[];for(let t=0;t<this.board[0].length;t++){let s=[];for(let e=0;e<this.board.length;e++)s.push(this.board[e][t]);e.push(s)}this.board=e}addRandomTile(){let e=[];for(let t=0;t<4;t++)for(let s=0;s<4;s++)0===this.board[t][s]&&e.push([t,s]);if(0===e.length)return;let[t,s]=e[Math.floor(Math.random()*e.length)];this.board[t][s]=.9>Math.random()?2:4,this.board.flat().includes(2048)&&(this.status="win",this.showMessage("You won!")),this.checkGameOver()}slideAndMerge(e){let t=e.filter(e=>0!==e),s=0,r=!1;for(let e=0;e<t.length-1;e++)t[e]===t[e+1]&&(t[e]*=2,s+=t[e],t.splice(e+1,1),r=!0);for(;t.length<4;)t.push(0);return t.join("")!==e.join("")&&(r=!0),{newRow:t,points:s,changed:r}}isGameOver(){for(let e=0;e<4;e++)for(let t=0;t<4;t++)if(0===this.board[e][t]||t<3&&this.board[e][t]===this.board[e][t+1]||e<3&&this.board[e][t]===this.board[e+1][t])return!1;return!0}checkGameOver(){!0===this.isGameOver()&&(this.status="lose",this.showMessage("Game Over!"))}getScore(){return this.score}getState(){return this.board}getStatus(){return this.status}render(){let e=document.querySelectorAll(".field-cell"),t=0;for(let s=0;s<4;s++)for(let r=0;r<4;r++){let i=e[t],o=this.board[s][r];i&&(i.innerHTML=o||"",i.className=`field-cell ${o?`field-cell--${o}`:""}`,t++)}}showMessage(e){let t=document.querySelector(".game-message");t&&(t.textContent=e,t.style.display="block")}hideMessage(){let e=document.querySelector(".game-message");e&&(e.style.display="none")}},t=document.querySelector(".button"),s=document.querySelector(".message-container"),r=document.querySelector(".message-lose"),i=document.querySelector(".message-win"),o=document.querySelector(".message-start");function a(e){s.classList.remove("hidden"),r.classList.add("hidden"),i.classList.add("hidden"),o.classList.add("hidden"),"lose"===e?r.classList.remove("hidden"):"win"===e?i.classList.remove("hidden"):"start"===e&&o.classList.remove("hidden")}t.addEventListener("click",()=>{"idle"===e.status?(e.start(),a("start"),t.classList.remove("start"),t.classList.add("restart"),t.textContent="Restart",o.textContent='Press "Restart" to start the new Game'):confirm("Хотите начать новую игру?")&&(e.restart(),e.start(),a("start"),t.textContent="Restart")}),document.addEventListener("keydown",t=>{if("playing"===e.status)switch(t.key){case"ArrowLeft":e.moveLeft();break;case"ArrowRight":e.moveRight();break;case"ArrowUp":e.moveUp();break;case"ArrowDown":e.moveDown()}e.isGameOver()?a("lose"):"win"===e.status&&a("win")});
//# sourceMappingURL=index.1f7b0764.js.map
